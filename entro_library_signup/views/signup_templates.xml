<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Extended Signup Form -->
    <template id="library_signup_form" name="Library Signup Form">
        <t t-call="website.layout">
            <div id="wrap" class="oe_structure oe_empty">
                <div class="container mt-5 mb-5">
                    <div class="row justify-content-center">
                        <div class="col-lg-8">
                            <div class="card shadow">
                                <div class="card-header bg-primary text-white">
                                    <h4 class="mb-0"><i class="fa fa-user-plus me-2"/>Đăng ký thẻ thư viện</h4>
                                </div>
                                <div class="card-body">
                                    
                                    <!-- Error message -->
                                    <div t-if="error" class="alert alert-danger alert-dismissible fade show" role="alert">
                                        <i class="fa fa-exclamation-triangle me-2"/><t t-esc="error"/>
                                        <button type="button" class="btn-close" data-bs-dismiss="alert"/>
                                    </div>

                                    <p class="lead">Điền thông tin để đăng ký tài khoản mượn sách tại thư viện</p>
                                    
                                    <form method="POST" action="/web/library/signup/submit" class="library_signup_form">
                                        <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>

                                        <!-- Personal Information -->
                                        <h5 class="mt-4 mb-3"><i class="fa fa-user me-2"/>Thông tin cá nhân</h5>
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Họ và tên <span class="text-danger">*</span></label>
                                                <input type="text" name="full_name" class="form-control" required="required" placeholder="Nguyễn Văn A"/>
                                            </div>

                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Pháp Danh</label>
                                                <input type="text" name="dharma_name" class="form-control" placeholder="Pháp danh (nếu có)"/>
                                            </div>

                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">CMND/CCCD</label>
                                                <input type="text" name="id_card_number" class="form-control" placeholder="079012345678"/>
                                            </div>

                                            
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Email <span class="text-danger">*</span></label>
                                                <input type="email" name="email" class="form-control" required="required" placeholder="email@example.com"/>
                                            </div>
                                            
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Số điện thoại <span class="text-danger">*</span></label>
                                                <input type="tel" name="phone" class="form-control" required="required" placeholder="0912345678"/>
                                            </div>
                                            
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Ngày sinh</label>
                                                <input type="date" name="date_of_birth" class="form-control"/>
                                            </div>
                                            
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Giới tính</label>
                                                <select name="gender" class="form-select">
                                                    <option value="">-- Chọn --</option>
                                                    <option value="male">Nam</option>
                                                    <option value="female">Nữ</option>
                                                    <option value="other">Khác</option>
                                                </select>
                                            </div>

                                            <div class="col-md-12 mb-3">
                                                <label class="form-label">Loại độc giả <span class="text-danger">*</span></label>
                                                <div class="mt-2">
                                                    <t t-foreach="borrower_types" t-as="btype">
                                                        <div class="form-check form-check-inline">
                                                            <input class="form-check-input" type="radio" name="borrower_type_id" t-att-id="'borrower_type_%s' % btype.id" t-att-value="btype.id" required="required"/>
                                                            <label class="form-check-label" t-att-for="'borrower_type_%s' % btype.id">
                                                                <t t-esc="btype.name"/>
                                                            </label>
                                                        </div>
                                                    </t>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Address -->
                                        <h5 class="mt-4 mb-3"><i class="fa fa-map-marker me-2"/>Địa chỉ</h5>
                                        <div class="row">
                                            <div class="col-md-12 mb-3">
                                                <label class="form-label">Địa chỉ</label>
                                                <input type="text" name="street" class="form-control" placeholder="Số nhà, tên đường"/>
                                            </div>
                                            
                                            <div class="col-md-12 mb-3">
                                                <label class="form-label">Địa chỉ 2</label>
                                                <input type="text" name="street2" class="form-control" placeholder="Phường/Xã"/>
                                            </div>
                                            
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Thành phố</label>
                                                <input type="text" name="city" class="form-control" placeholder="Thành phố"/>
                                            </div>
                                            
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Mã bưu điện</label>
                                                <input type="text" name="zip" class="form-control" placeholder="700000"/>
                                            </div>
                                            
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Quốc gia</label>
                                                <select name="country_id" class="form-select">
                                                    <t t-foreach="countries" t-as="country">
                                                        <option t-att-value="country.id" t-att-selected="'selected' if default_country and country.id == default_country.id else None" t-esc="country.name"/>
                                                    </t>
                                                </select>
                                            </div>
                                        </div>

                                        <!-- Notes -->
                                        <h5 class="mt-4 mb-3"><i class="fa fa-comment me-2"/>Ghi chú</h5>
                                        <div class="row">
                                            <div class="col-md-12 mb-3">
                                                <label class="form-label">Ghi chú thêm (nếu có)</label>
                                                <textarea name="notes" class="form-control" rows="3" placeholder="Thông tin bổ sung..."/>
                                            </div>
                                        </div>

                                        <!-- Submit -->
                                        <div class="row mt-4">
                                            <div class="col-md-12">
                                                <div class="alert alert-info">
                                                    <i class="fa fa-info-circle me-2"/>
                                                    <strong>Lưu ý:</strong> Sau khi gửi đăng ký, quản lý thư viện sẽ xem xét và phê duyệt. Bạn sẽ nhận được email thông báo khi tài khoản được kích hoạt.
                                                </div>
                                                <button type="submit" class="btn btn-primary btn-lg w-100">
                                                    <i class="fa fa-paper-plane me-2"/>Gửi đăng ký
                                                </button>
                                                <a href="/thu-vien" class="btn btn-outline-secondary btn-lg w-100 mt-2">
                                                    <i class="fa fa-arrow-left me-2"/>Quay lại thư viện
                                                </a>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <!-- Success Page -->
    <template id="library_signup_success" name="Library Signup Success">
        <t t-call="website.layout">
            <div id="wrap" class="oe_structure">
                <div class="container mt-5 mb-5">
                    <div class="row justify-content-center">
                        <div class="col-lg-6 text-center">
                            <div class="card shadow">
                                <div class="card-body p-5">
                                    <i class="fa fa-check-circle text-success" style="font-size: 5rem;"/>
                                    <h2 class="mt-4 mb-3">Đăng ký thành công!</h2>
                                    <p class="lead">Cảm ơn bạn đã đăng ký.</p>
                                    <p>Yêu cầu của bạn đang được xem xét. Quản lý thư viện sẽ duyệt và gửi thông báo qua email trong thời gian sớm nhất.</p>
                                    <hr class="my-4"/>
                                    <p class="text-muted"><strong>Lưu ý:</strong> Vui lòng kiểm tra hộp thư email (cả mục spam) để nhận thông báo kích hoạt tài khoản.</p>
                                    <a href="/thu-vien" class="btn btn-primary btn-lg mt-3">
                                        <i class="fa fa-home me-2"/>Về trang chủ thư viện
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <!-- Add Register Link to Login Page -->
    <template id="library_signup_login_link" inherit_id="web.login" name="Library Signup Link">
        <xpath expr="//div[hasclass('oe_login_buttons')]" position="after">
            <div class="text-center mt-3">
                <span>Chưa có thẻ thư viện? </span>
                <a href="/web/library/signup">Đăng ký</a>
            </div>
        </xpath>
    </template>

</odoo>
