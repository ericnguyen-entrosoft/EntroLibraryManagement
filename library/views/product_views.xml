<?xml version="1.0" ?>
<odoo>
    <!-- Form View Of Product Book -->
    <record id="view_product_book_form" model="ir.ui.view">
        <field name="name">product.book.form.view</field>
        <field name="model">product.product</field>
        <field name="priority">16</field>
        <field name="arch" type="xml">
            <form string="Books">
                <header>
                    <button name="action_borrow_book" 
                            string="Mượn sách" 
                            type="object" 
                            class="oe_highlight"
                            groups="library.group_librarian,library.group_userian"/>
                    <button name="action_add_quantity" 
                            string="Thêm số lượng" 
                            type="object"
                            class="btn-secondary" 
                            groups="library.group_librarian"/>
                    <button name="action_print_barcode_labels" 
                            string="In nhãn mã vạch" 
                            type="object" 
                            class="btn-secondary"
                            groups="library.group_librarian"/>
                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button
                            name="action_update_quantity_on_hand"
                            type="object"
                            icon="fa-book"
                            groups="library.group_librarian"
                        >
                            <field
                                string="Vị trí"
                                name="qty_available"
                                widget="statinfo"
                            />
                        </button>
                        <button name="action_view_borrowing_transfers" 
                                type="object" 
                                icon="fa-exchange"
                                groups="library.group_librarian">
                            <div class="o_field_widget o_stat_info">
                                <span class="o_stat_value">
                                    <field name="borrowing_count"/>
                                </span>
                                <span class="o_stat_text">Phiếu mượn</span>
                            </div>
                        </button>
                        <button name="action_internal_transfer" 
                                type="object" 
                                icon="fa-arrows"
                                groups="library.group_librarian">
                            <div class="o_field_widget o_stat_info">
                                <span class="o_stat_text">Chuyển</span>
                                <span class="o_stat_text">kho</span>
                            </div>
                        </button>
                    </div>
                    <field name="image_1920" widget="image" class="oe_avatar" options="{'preview_image': 'image_128'}"/>
                    <div class="oe_title">
                        <label for="name" string="Tên sách"/>
                        <h1>
                            <field
                                name="name"
                                class="text-break"
                                options="{'line_breaks': False}" 
                                widget="text"
                                placeholder="Tên sách"
                            />
                        </h1>
                        <div name="options">
                            <span class="d-inline-flex">
                                <field name="sale_ok" string="Có thể bán"/>
                                <label for="sale_ok"/>
                            </span>
                            <span class="d-inline-flex">
                                <field name="purchase_ok" string="Có thể mua"/>
                                <label for="purchase_ok"/>
                            </span>
                        </div>
                    </div>
                    <group>
                        <group name="group_left">
                            <field name="isbn" placeholder="ISBN Number" />
                            <field
                                name="default_code"
                                placeholder="Enter Book Default code"
                            />
                            <field
                                name="barcode"
                                placeholder="Barcode e.g.5941246894325"
                            />
                            <field
                                name="categ_id"
                                placeholder="Select or Create Book"
                                options="{'no_create': True,}"
                                domain="[('book_categ','=',True)]"
                            />
                        </group>
                        <group name="group_right">
                            <field
                                name="author"
                                placeholder="Name of Author"
                                options="{'no_create': True,}"
                            />
                            <field name="list_price" string="Giá bán"/>
                            <field name="standard_price" string="Chi phí"/>
                            <field name="uom_id" groups="uom.group_uom"/>
                            <field name="type" invisible="1" />
                        </group>
                    </group>
                    <notebook>
                        <page string="Thông tin chung">
                            <group>
                                <group name="group_general_left" string="Thông tin cơ bản">
                                    <field
                                        name="availability"
                                        invisible="is_ebook == True"
                                    />
                                    <field
                                        name="nbpage"
                                        placeholder="No of Page in books"
                                    />
                                    <field
                                        name="day_to_return_book"
                                        placeholder="Days of Returnning"
                                        required="is_ebook == False"
                                        invisible="is_ebook == True"
                                    />
                                    <field name="creation_date" />
                                    <field name="tome" />
                                    <field name="format" placeholder="Format of Book" />
                                    <field name="weight" invisible="is_ebook == True" />
                                </group>
                                <group name="group_general_right" string="Thông tin bổ sung">
                                    <field name="back" />
                                    <field
                                        name="num_edition"
                                        placeholder="No of Addition of Book"
                                    />
                                    <field
                                        name="catalog_num"
                                        placeholder="Enter Catalog No"
                                    />
                                    <field
                                        name="lang"
                                        placeholder="Language of Book"
                                        options="{'no_create': True,}"
                                    />
                                    <field name="is_ebook" />
                                    <field
                                        name="is_subscription"
                                        invisible="is_ebook == False"
                                    />
                                    <field
                                        name="subscrption_amt"
                                        required="is_subscription == True"
                                        invisible="is_ebook == False"
                                    />
                                    <field
                                        name="attach_ebook"
                                        required="is_ebook == True"
                                        invisible="is_ebook == False"
                                    />
                                </group>
                            </group>
                        </page>
                        <page string="Tác giả">
                            <field name="editor_ids" />
                        </page>
                        <page string="Quy định phạt">
                            <group>
                                <field name="fine_lost" string="Fine Lost" />
                                <field
                                    name="fine_late_return"
                                    string="Fine amount if late return"
                                />
                            </group>
                        </page>
                        <page string="Số serial">
                            <group>
                                <field name="total_lots" readonly="1"/>
                                <field name="available_lots" readonly="1"/>
                                <field name="tracking" readonly="1"/>
                            </group>
                            <field name="lot_ids" nolabel="1">
                                <tree>
                                    <field name="name" readonly="1"/>
                                    <field name="library_barcode" readonly="1"/>
                                    <field name="create_date" readonly="1"/>
                                    <field name="product_qty" readonly="1"/>
                                    <button name="action_print_barcode_label" 
                                            type="object" 
                                            string="In nhãn" 
                                            icon="fa-print"
                                            title="In nhãn mã vạch"/>
                                </tree>
                            </field>
                        </page>
                        <page string="Mô tả">
                            <field
                                name="description"
                                colspan="4"
                                nolabel="1"
                                placeholder="Enter Description About Book"
                            />
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Tree View Of Product Book -->
    <record id="view_product_book_tree" model="ir.ui.view">
        <field name="name">product.book.tree.view</field>
        <field name="model">product.product</field>
        <field name="priority" eval="1" />
        <field name="arch" type="xml">
            <tree>
                <field name="name" />
                <field name="uom_id" />
                <field name="categ_id" />
                <field name="barcode" />
                <field name="catalog_num" />
                <field name="date_retour" />
                <field
                    name="availability"
                    widget="badge"
                    decoration-danger="availability == 'available'"
                    decoration-success="availability == 'notavailable'"
                />
            </tree>
        </field>
    </record>

    <!-- KanBan View Of Books -->
    <record id="books_kanban_view" model="ir.ui.view">
        <field name="name">Book Kanban View</field>
        <field name="model">product.product</field>
        <field name="arch" type="xml">
            <kanban>
                <field name="name" />
                <field name="author" />
                <field name="books_available" />
                <field name="image_1920" />
                <field name="id" />
                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_global_click" style="background-color: #f9f9f9; border: 1px solid #ddd; border-radius: 8px; padding: 8px; margin: 4px; height: auto;">
                            <!-- Book Image -->
                            <div class="o_kanban_image text-center" style="margin-bottom: 6px;">
                                <img t-att-src="kanban_image('product.product', 'image_1920', record.id.raw_value)" 
                                     alt="Book Cover" 
                                     style="max-height: 70px; max-width: 100%; border-radius: 4px; box-shadow: 0 1px 2px rgba(0,0,0,0.1);"/>
                            </div>
                            
                            <!-- Book Details -->
                            <div class="oe_kanban_details">
                                <!-- Book Name -->
                                <div class="o_kanban_record_title text-center" style="margin-bottom: 4px;">
                                    <strong style="font-size: 12px; color: #2c3e50; line-height: 1.1;">
                                        <field name="name" />
                                    </strong>
                                </div>
                                
                                <!-- Author -->
                                <div class="text-center" style="margin-bottom: 4px; color: #7f8c8d; font-size: 10px;">
                                    <i class="fa fa-user" style="margin-right: 2px;"/>
                                    <span t-if="record.author.raw_value">
                                        <field name="author" />
                                    </span>
                                    <span t-if="!record.author.raw_value" style="font-style: italic;">
                                        Chưa có tác giả
                                    </span>
                                </div>
                                
                                <!-- Number of books available -->
                                <div class="text-center">
                                    <div t-attf-class="badge {{ record.books_available.raw_value > 0 ? 'bg-success' : 'bg-danger' }}" 
                                         style="font-size: 10px; padding: 2px 6px;">
                                        <i class="fa fa-book" style="margin-right: 2px;"/>
                                        <field name="books_available" /> có thể mượn
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- Search View Of Product Book Search -->
    <record id="view_product_book_search" model="ir.ui.view">
        <field name="name">product.book.search.view</field>
        <field name="model">product.product</field>
        <field name="arch" type="xml">
            <search string="Assignment Information">
                <filter
                    name="book"
                    string="Sách"
                    domain="[('categ_id.book_categ', '=', True)]"
                />
                <separator orientation="vertical" />
                <field name="name" />
            </search>
        </field>
    </record>

    <!-- Action Of Product Book List -->
    <record id="action_product_book_list" model="ir.actions.act_window">
        <field name="name">Sách</field>
        <field name="res_model">product.product</field>
        <field name="type">ir.actions.act_window</field>
        <field name="view_mode">kanban,tree,form</field>
        <field name="view_id" ref="books_kanban_view" />
        <field name="context">{'search_default_book':1,'default_type':'product'}</field>
    </record>

    <!-- Action Of Form View Of View Book -->
    <record id="action_view_book" model="ir.actions.act_window.view">
        <field name="sequence" eval="3" />
        <field name="view_mode">form</field>
        <field name="view_id" ref="view_product_book_form" />
        <field name="act_window_id" ref="action_product_book_list" />
    </record>

    <!--  Action of Kanban View -->
    <record id="action_viewbook3_kanban" model="ir.actions.act_window.view">
        <field name="sequence" eval="1" />
        <field name="view_mode">kanban</field>
        <field name="view_id" ref="books_kanban_view" />
        <field name="act_window_id" ref="action_product_book_list" />
    </record>

    <!-- Action Of Tree View Of View Book -->
    <record id="action_view_book2" model="ir.actions.act_window.view">
        <field name="sequence" eval="2" />
        <field name="view_mode">tree</field>
        <field name="view_id" ref="view_product_book_tree" />
        <field name="act_window_id" ref="action_product_book_list" />
    </record>
</odoo>