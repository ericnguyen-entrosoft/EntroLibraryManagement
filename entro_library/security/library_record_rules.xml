<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="0">
        <!-- ================================================================ -->
        <!-- Record Rules for Portal Users (base.group_portal)               -->
        <!-- Purpose: Restrict portal users to see only their own records    -->
        <!-- ================================================================ -->

        <!-- Note: Internal users (base.group_user) have no record rules     -->
        <!-- They can see all records in read-only mode as designed          -->

        <!-- ================================================================ -->
        <!-- BORROWING RECORDS                                                -->
        <!-- ================================================================ -->

        <record id="library_borrowing_portal_rule" model="ir.rule">
            <field name="name">Portal Users: Own Borrowing Records Only</field>
            <field name="model_id" ref="model_library_borrowing"/>
            <field name="domain_force">[('borrower_id.user_id', '=', user.id)]</field>
            <field name="groups" eval="[(4, ref('base.group_portal'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <record id="library_borrowing_line_portal_rule" model="ir.rule">
            <field name="name">Portal Users: Own Borrowing Lines Only</field>
            <field name="model_id" ref="model_library_borrowing_line"/>
            <field name="domain_force">[('borrowing_id.borrower_id.user_id', '=', user.id)]</field>
            <field name="groups" eval="[(4, ref('base.group_portal'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <record id="library_borrowing_quant_line_portal_rule" model="ir.rule">
            <field name="name">Portal Users: Own Borrowing Quant Lines Only</field>
            <field name="model_id" ref="model_library_borrowing_quant_line"/>
            <field name="domain_force">[('borrowing_id.borrower_id.user_id', '=', user.id)]</field>
            <field name="groups" eval="[(4, ref('base.group_portal'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- ================================================================ -->
        <!-- RESERVATIONS                                                     -->
        <!-- ================================================================ -->

        <record id="library_reservation_portal_rule" model="ir.rule">
            <field name="name">Portal Users: Own Reservations Only</field>
            <field name="model_id" ref="model_library_reservation"/>
            <field name="domain_force">[('borrower_id.user_id', '=', user.id)]</field>
            <field name="groups" eval="[(4, ref('base.group_portal'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- ================================================================ -->
        <!-- MEDIA ACCESS                                                     -->
        <!-- ================================================================ -->

        <record id="library_media_portal_rule" model="ir.rule">
            <field name="name">Portal Users: Public Media Only</field>
            <field name="model_id" ref="model_library_media"/>
            <field name="domain_force">[('access_level', '=', 'public')]</field>
            <field name="groups" eval="[(4, ref('base.group_portal'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- ================================================================ -->
        <!-- Library Staff: Bypass all restrictions (see all records)        -->
        <!-- ================================================================ -->

        <record id="library_borrowing_staff_all_rule" model="ir.rule">
            <field name="name">Library Staff: All Borrowing Records</field>
            <field name="model_id" ref="model_library_borrowing"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_library_user'))]"/>
        </record>

        <record id="library_borrowing_line_staff_all_rule" model="ir.rule">
            <field name="name">Library Staff: All Borrowing Lines</field>
            <field name="model_id" ref="model_library_borrowing_line"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_library_user'))]"/>
        </record>

        <record id="library_borrowing_quant_line_staff_all_rule" model="ir.rule">
            <field name="name">Library Staff: All Borrowing Quant Lines</field>
            <field name="model_id" ref="model_library_borrowing_quant_line"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_library_user'))]"/>
        </record>

        <record id="library_reservation_staff_all_rule" model="ir.rule">
            <field name="name">Library Staff: All Reservations</field>
            <field name="model_id" ref="model_library_reservation"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_library_user'))]"/>
        </record>

        <record id="library_media_staff_all_rule" model="ir.rule">
            <field name="name">Library Staff: All Media (All Access Levels)</field>
            <field name="model_id" ref="model_library_media"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_library_user'))]"/>
        </record>

    </data>
</odoo>
