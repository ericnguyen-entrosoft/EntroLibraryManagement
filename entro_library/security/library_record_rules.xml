<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="0">
        <!-- ================================================================ -->
        <!-- Record Rules for Portal Users (base.group_portal)               -->
        <!-- Purpose: Restrict portal users to see only their own records    -->
        <!-- ================================================================ -->

        <!-- Note: Internal users (base.group_user) have no record rules     -->
        <!-- They can see all records in read-only mode as designed          -->

        <!-- ================================================================ -->
        <!-- BORROWING RECORDS                                                -->
        <!-- ================================================================ -->

        <record id="library_borrowing_portal_rule" model="ir.rule">
            <field name="name">Portal Users: Own Borrowing Records Only</field>
            <field name="model_id" ref="model_library_borrowing"/>
            <field name="domain_force">[('borrower_id.user_id', '=', user.id)]</field>
            <field name="groups" eval="[(4, ref('base.group_portal'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <record id="library_borrowing_line_portal_rule" model="ir.rule">
            <field name="name">Portal Users: Own Borrowing Lines Only</field>
            <field name="model_id" ref="model_library_borrowing_line"/>
            <field name="domain_force">[('borrowing_id.borrower_id.user_id', '=', user.id)]</field>
            <field name="groups" eval="[(4, ref('base.group_portal'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <record id="library_borrowing_quant_line_portal_rule" model="ir.rule">
            <field name="name">Portal Users: Own Borrowing Quant Lines Only</field>
            <field name="model_id" ref="model_library_borrowing_quant_line"/>
            <field name="domain_force">[('borrowing_id.borrower_id.user_id', '=', user.id)]</field>
            <field name="groups" eval="[(4, ref('base.group_portal'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- ================================================================ -->
        <!-- RESERVATIONS                                                     -->
        <!-- Note: Portal users can see all reservations for browsing books   -->
        <!-- but in practice, they typically only access their own            -->
        <!-- ================================================================ -->

        <record id="library_reservation_portal_rule" model="ir.rule">
            <field name="name">Portal Users: All Reservations (for book browsing)</field>
            <field name="model_id" ref="model_library_reservation"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('base.group_portal'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- ================================================================ -->
        <!-- MEDIA ACCESS                                                     -->
        <!-- ================================================================ -->

        <record id="library_media_portal_rule" model="ir.rule">
            <field name="name">Portal Users: Public Media Only</field>
            <field name="model_id" ref="model_library_media"/>
            <field name="domain_force">[('access_level', '=', 'public')]</field>
            <field name="groups" eval="[(4, ref('base.group_portal'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- ================================================================ -->
        <!-- MASTER DATA ACCESS - Portal users can see ALL master data       -->
        <!-- ================================================================ -->

        <!-- Books - All records -->
        <record id="library_book_portal_all_rule" model="ir.rule">
            <field name="name">Portal Users: All Books</field>
            <field name="model_id" ref="model_library_book"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('base.group_portal'))]"/>
        </record>

        <!-- Book Quants - All records -->
        <record id="library_book_quant_portal_all_rule" model="ir.rule">
            <field name="name">Portal Users: All Book Quants</field>
            <field name="model_id" ref="model_library_book_quant"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('base.group_portal'))]"/>
        </record>

        <!-- Book Images - All records -->
        <record id="library_book_image_portal_all_rule" model="ir.rule">
            <field name="name">Portal Users: All Book Images</field>
            <field name="model_id" ref="model_library_book_image"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('base.group_portal'))]"/>
        </record>

        <!-- Authors - All records -->
        <record id="library_author_portal_all_rule" model="ir.rule">
            <field name="name">Portal Users: All Authors</field>
            <field name="model_id" ref="model_library_author"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('base.group_portal'))]"/>
        </record>

        <!-- Publishers - All records -->
        <record id="library_publisher_portal_all_rule" model="ir.rule">
            <field name="name">Portal Users: All Publishers</field>
            <field name="model_id" ref="model_library_publisher"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('base.group_portal'))]"/>
        </record>

        <!-- Categories - All records -->
        <record id="library_category_portal_all_rule" model="ir.rule">
            <field name="name">Portal Users: All Categories</field>
            <field name="model_id" ref="model_library_category"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('base.group_portal'))]"/>
        </record>

        <!-- Series - All records -->
        <record id="library_series_portal_all_rule" model="ir.rule">
            <field name="name">Portal Users: All Series</field>
            <field name="model_id" ref="model_library_series"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('base.group_portal'))]"/>
        </record>

        <!-- Locations - All records -->
        <record id="library_location_portal_all_rule" model="ir.rule">
            <field name="name">Portal Users: All Locations</field>
            <field name="model_id" ref="model_library_location"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('base.group_portal'))]"/>
        </record>

        <!-- Resources - All records -->
        <record id="library_resource_portal_all_rule" model="ir.rule">
            <field name="name">Portal Users: All Resources</field>
            <field name="model_id" ref="model_library_resource"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('base.group_portal'))]"/>
        </record>

        <!-- Media Categories - All records -->
        <record id="library_media_category_portal_all_rule" model="ir.rule">
            <field name="name">Portal Users: All Media Categories</field>
            <field name="model_id" ref="model_library_media_category"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('base.group_portal'))]"/>
        </record>

        <!-- Character Mapping - All records -->
        <record id="character_mapping_portal_all_rule" model="ir.rule">
            <field name="name">Public: All Character Mappings</field>
            <field name="model_id" ref="model_character_mapping"/>
            <field name="domain_force">[(1, '=', 1)]</field>
        </record>

        <!-- ================================================================ -->
        <!-- Library Staff: Bypass all restrictions (see all records)        -->
        <!-- ================================================================ -->

        <record id="library_borrowing_staff_all_rule" model="ir.rule">
            <field name="name">Library Staff: All Borrowing Records</field>
            <field name="model_id" ref="model_library_borrowing"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_library_user'))]"/>
        </record>

        <record id="library_borrowing_line_staff_all_rule" model="ir.rule">
            <field name="name">Library Staff: All Borrowing Lines</field>
            <field name="model_id" ref="model_library_borrowing_line"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_library_user'))]"/>
        </record>

        <record id="library_borrowing_quant_line_staff_all_rule" model="ir.rule">
            <field name="name">Library Staff: All Borrowing Quant Lines</field>
            <field name="model_id" ref="model_library_borrowing_quant_line"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_library_user'))]"/>
        </record>

        <record id="library_reservation_staff_all_rule" model="ir.rule">
            <field name="name">Library Staff: All Reservations</field>
            <field name="model_id" ref="model_library_reservation"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_library_user'))]"/>
        </record>

        <record id="library_media_staff_all_rule" model="ir.rule">
            <field name="name">Library Staff: All Media (All Access Levels)</field>
            <field name="model_id" ref="model_library_media"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_library_user'))]"/>
        </record>

    </data>
</odoo>
