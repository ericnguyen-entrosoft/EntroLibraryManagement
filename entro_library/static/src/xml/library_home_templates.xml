<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">

    <t t-name="entro_library.LibraryHomeTemplate">
        <div class="o_library_home">
            <div class="o_library_home_container">
                <!-- Left Sidebar: Resource List -->
                <div class="o_library_home_sidebar">
                    <div class="o_library_home_sidebar_header">
                        <h4 style="color:#591202">Kho tài nguyên</h4>
                    </div>
                    <div class="o_library_home_sidebar_content">
                        <t t-if="state.isLoading">
                            <div class="text-center p-4">
                                <i class="fa fa-spinner fa-spin fa-2x"/>
                            </div>
                        </t>
                        <t t-else="">
                            <t t-if="state.resources.length === 0">
                                <div class="text-muted text-center p-4">
                                    <p>Chưa có tài nguyên nào</p>
                                </div>
                            </t>
                            <t t-else="">
                                <div class="o_library_resource_list">
                                    <t t-foreach="state.resources" t-as="resource" t-key="resource.id">
                                        <div class="o_library_resource_item"
                                             t-att-class="{'active': state.selectedResource &amp;&amp; state.selectedResource.id === resource.id}"
                                             t-on-click="() => this.selectResource(resource)">
                                            <div class="o_library_resource_icon">
                                                <img t-att-src="getResourceLogo(resource, state.selectedResource &amp;&amp; state.selectedResource.id === resource.id)" alt="Logo" class="o_library_resource_logo"/>
                                            </div>
                                            <div class="o_library_resource_info">
                                                <div class="o_library_resource_name" style="color:#591202">
                                                    <t t-esc="resource.name"/>
                                                </div>
                                                <!-- <div class="o_library_resource_stats">
                                                    <small class="text-muted" style="color:#8C675A">
                                                        <i class="fa fa-book"/> <t t-esc="resource.book_count"/> sách
                                                    </small>
                                                </div> -->
                                            </div>
                                        </div>
                                    </t>
                                </div>
                            </t>
                        </t>
                    </div>
                </div>

                <!-- Main Content: Policy and Books -->
                <div class="o_library_home_main">
                    <t t-if="state.selectedResource">
                        <!-- Policy Section -->
                        <div class="o_library_home_policy">
                            <div class="o_library_home_policy_header">
                                <h3 style="color:#591202">
                                    <img t-att-src="getResourceLogo(state.selectedResource)" alt="Logo" class="o_library_resource_logo_header me-2"/>
                                    <t t-esc="state.selectedResource.name"/>
                                </h3>
                            </div>
                            <div class="o_library_home_policy_content">
                                <t t-if="state.selectedResource.description">
                                    <div class="o_library_description_section">
                                        <div t-out="state.selectedResource.description"/>
                                    </div>
                                </t>
                                <t t-if="state.selectedResource.policy">
                                    <div class="o_library_policy_section">
                                        <h5 style="color:#8C675A">Nội quy</h5>
                                        <div t-out="state.selectedResource.policy"/>
                                    </div>
                                </t>
                                
                            </div>
                        </div>

                        <!-- Book Search Section -->
                        <div class="o_library_home_books">
                            <div class="o_library_home_books_header">
                                <h4 style="color:#8C675A">Sách</h4>
                                <div class="o_library_home_search">
                                    <input type="text"
                                           class="form-control"
                                           placeholder="Tìm kiếm sách theo tên, tác giả, từ khóa..."
                                           t-model="state.searchQuery"
                                           t-on-input="onSearchInput"/>
                                    <i class="fa fa-search"/>
                                </div>
                            </div>
                            <div class="o_library_home_books_content">
                                <t t-if="state.books.length === 0">
                                    <div class="text-muted text-center p-4">
                                        <i class="fa fa-book fa-3x mb-3"/>
                                        <p>
                                            <t t-if="state.searchQuery">
                                                Không tìm thấy sách nào phù hợp
                                            </t>
                                            <t t-else="">
                                                Chưa có sách nào trong tài nguyên này
                                            </t>
                                        </p>
                                    </div>
                                </t>
                                <t t-else="">
                                    <div class="o_library_books_grid">
                                        <t t-foreach="state.books" t-as="book" t-key="book.id">
                                            <div class="o_library_book_card"
                                                 t-on-click="() => this.onBookClick(book.id)">
                                                <div class="o_library_book_image">
                                                    <img t-att-src="getBookImageUrl(book)" alt="Book cover"/>
                                                </div>
                                                <div class="o_library_book_info">
                                                    <h6 class="o_library_book_title">
                                                        <t t-esc="book.name"/>
                                                    </h6>
                                                    <div class="o_library_book_authors text-muted">
                                                        <t t-if="book.author_names">
                                                            <small>
                                                                <t t-esc="book.author_names"/>
                                                            </small>
                                                        </t>
                                                    </div>
                                                    <div class="o_library_book_meta">
                                                        <t t-if="book.publication_year">
                                                            <small class="text-muted">
                                                                <i class="fa fa-calendar"/> <t t-esc="book.publication_year"/>
                                                            </small>
                                                        </t>
                                                    </div>
                                                    <div class="o_library_book_stats mb-2">
                                                        <span class="badge text-bg-success">
                                                            <i class="fa fa-check"/> <t t-esc="book.available_quant_count"/> có sẵn
                                                        </span>
                                                    </div>
                                                    <div class="o_library_book_actions">
                                                        <t t-if="book.available_quant_count > 0">
                                                            <button class="btn btn-sm btn-primary w-100"
                                                                    t-on-click.stop="(ev) => this.onAddToBorrowing(book.id, ev)">
                                                                <i class="fa fa-plus"/> Thêm vào mượn
                                                            </button>
                                                        </t>
                                                        <t t-else="">
                                                            <button class="btn btn-sm btn-secondary w-100" disabled="disabled">
                                                                <i class="fa fa-ban"/> Hết sách
                                                            </button>
                                                        </t>
                                                    </div>
                                                </div>
                                            </div>
                                        </t>
                                    </div>
                                </t>
                            </div>
                        </div>
                    </t>
                    <t t-else="">
                        <div class="o_library_home_empty text-center p-5">
                            <i class="fa fa-book fa-4x text-muted mb-3"/>
                            <h4 class="text-muted">Vui lòng chọn một tài nguyên</h4>
                        </div>
                    </t>
                </div>
            </div>
        </div>
    </t>

</templates>
