<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- ========== MEDIA LISTING PAGE ========== -->

    <template id="library_media_list" name="Phương Tiện - Danh Sách">
        <t t-call="website.layout">
            <t t-set="pageName" t-value="'library_media'"/>

            <head>
                <style>
                    /* Hero Banner Section */
                    .media_hero_banner {
                        position: relative;
                        /* Background is set inline per menu category */
                        padding: 4rem 2rem;
                        overflow: hidden;
                        min-height: 400px;
                        margin-bottom: 2rem;
                    }

                    .media_hero_content {
                        position: relative;
                        z-index: 2;
                        max-width: 1400px;
                        margin: 0 auto;
                        color: #FFFFFF;
                        text-align: center;
                    }

                    .media_hero_content .tagline {
                        color: #FFFFFF;
                        font-size: 1rem;
                        margin-bottom: 1rem;
                        font-weight: 500;
                        text-transform: uppercase;
                        letter-spacing: 0.1em;
                    }

                    .media_hero_content h1 {
                        font-size: 3.5rem;
                        font-weight: 700;
                        line-height: 1.2;
                        margin-bottom: 1.5rem;
                        color: #FFFFFF;
                    }

                    .media_hero_content .subtitle {
                        font-size: 1.1rem;
                        color: #FFFFFF;
                        margin-bottom: 2rem;
                        line-height: 1.8;
                        max-width: 800px;
                        margin-left: auto;
                        margin-right: auto;
                    }

                    @media (max-width: 768px) {
                        .media_hero_banner {
                            padding: 2rem 1rem;
                            min-height: 300px;
                        }

                        .media_hero_content h1 {
                            font-size: 2rem;
                        }

                        .media_hero_content .subtitle {
                            font-size: 0.95rem;
                        }
                    }

                    /* Sidebar Filter Cards */
                    .media_filter_card {
                        background: #ffffff;
                        border-radius: 12px;
                        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
                        overflow: hidden;
                        transition: all 0.3s ease;
                    }

                    .media_filter_card:hover {
                        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
                    }

                    .filter_card_header {
                        background: #8c675a;
                        color: #ffffff;
                        padding: 1rem 1.25rem;
                        display: flex;
                        align-items: center;
                    }

                    .filter_card_header h5 {
                        font-size: 1rem;
                        font-weight: 600;
                        margin: 0;
                    }

                    .filter_card_body {
                        padding: 1.25rem;
                    }

                    /* Media Type Checkboxes */
                    .media_type_checkboxes {
                        display: flex;
                        flex-direction: column;
                        gap: 0.35rem;
                    }

                    .media_type_checkbox_item {
                        display: block;
                        cursor: pointer;
                        margin: 0;
                        position: relative;
                    }

                    .media_type_checkbox_item input[type="checkbox"] {
                        position: absolute;
                        opacity: 0;
                        cursor: pointer;
                    }

                    .media_type_checkbox_item .checkbox_content {
                        display: flex;
                        align-items: center;
                        padding: 0.5rem 0.75rem;
                        padding-left: 2.25rem;
                        border-radius: 6px;
                        color: #8c675a;
                        background: transparent;
                        transition: all 0.25s ease;
                        position: relative;
                    }

                    /* Custom checkbox */
                    .media_type_checkbox_item .checkbox_content:before {
                        content: '';
                        position: absolute;
                        left: 0.5rem;
                        width: 16px;
                        height: 16px;
                        border: 2px solid #8c675a;
                        border-radius: 3px;
                        background: #ffffff;
                        transition: all 0.25s ease;
                    }

                    /* Checkmark */
                    .media_type_checkbox_item .checkbox_content:after {
                        content: '\f00c';
                        font-family: 'FontAwesome';
                        position: absolute;
                        left: 0.65rem;
                        top: 50%;
                        transform: translateY(-50%);
                        font-size: 10px;
                        color: #ffffff;
                        opacity: 0;
                        transition: all 0.25s ease;
                    }

                    .media_type_checkbox_item:hover .checkbox_content {
                        background: #f2e5d5;
                    }

                    .media_type_checkbox_item input[type="checkbox"]:checked + .checkbox_content {
                        background: #8c675a;
                        color: #ffffff;
                        font-weight: 600;
                    }

                    .media_type_checkbox_item input[type="checkbox"]:checked + .checkbox_content:before {
                        background: #ffffff;
                        border-color: #ffffff;
                    }

                    .media_type_checkbox_item input[type="checkbox"]:checked + .checkbox_content:after {
                        opacity: 1;
                        color: #8c675a;
                    }

                    .media_type_checkbox_item .checkbox_content i {
                        color: inherit;
                        font-size: 0.95rem;
                    }

                    .media_type_checkbox_item .checkbox_content span {
                        font-size: 0.875rem;
                        font-weight: inherit;
                    }

                    /* Category Checkboxes */
                    .category_checkboxes {
                        display: flex;
                        flex-direction: column;
                        gap: 0.35rem;
                    }

                    .category_checkbox_item {
                        display: block;
                        cursor: pointer;
                        margin: 0;
                        position: relative;
                    }

                    .category_checkbox_item input[type="checkbox"] {
                        position: absolute;
                        opacity: 0;
                        cursor: pointer;
                    }

                    .category_checkbox_item .checkbox_content {
                        display: flex;
                        align-items: center;
                        padding: 0.5rem 0.75rem;
                        padding-left: 2.25rem;
                        border-radius: 6px;
                        color: #8c675a;
                        background: transparent;
                        transition: all 0.25s ease;
                        position: relative;
                    }

                    /* Custom checkbox */
                    .category_checkbox_item .checkbox_content:before {
                        content: '';
                        position: absolute;
                        left: 0.5rem;
                        width: 16px;
                        height: 16px;
                        border: 2px solid #8c675a;
                        border-radius: 3px;
                        background: #ffffff;
                        transition: all 0.25s ease;
                    }

                    /* Checkmark */
                    .category_checkbox_item .checkbox_content:after {
                        content: '\f00c';
                        font-family: 'FontAwesome';
                        position: absolute;
                        left: 0.65rem;
                        top: 50%;
                        transform: translateY(-50%);
                        font-size: 10px;
                        color: #ffffff;
                        opacity: 0;
                        transition: all 0.25s ease;
                    }

                    .category_checkbox_item:hover .checkbox_content {
                        background: #f2e5d5;
                    }

                    .category_checkbox_item input[type="checkbox"]:checked + .checkbox_content {
                        background: #8c675a;
                        color: #ffffff;
                        font-weight: 600;
                    }

                    .category_checkbox_item input[type="checkbox"]:checked + .checkbox_content:before {
                        background: #ffffff;
                        border-color: #ffffff;
                    }

                    .category_checkbox_item input[type="checkbox"]:checked + .checkbox_content:after {
                        opacity: 1;
                        color: #8c675a;
                    }

                    .category_checkbox_item .checkbox_content i {
                        color: inherit;
                        font-size: 0.95rem;
                    }

                    .category_checkbox_item .checkbox_content span {
                        font-size: 0.875rem;
                        font-weight: inherit;
                    }

                    /* Search Box */
                    .media_sidebar_search .input-group {
                        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
                        border-radius: 8px;
                        overflow: hidden;
                    }

                    .media_sidebar_search .form-control {
                        border: 1px solid #f2e5d5;
                        padding: 0.75rem 1rem;
                    }

                    .media_sidebar_search .form-control:focus {
                        border-color: #8c675a;
                        box-shadow: 0 0 0 0.2rem rgba(140, 103, 90, 0.15);
                    }

                    .media_sidebar_search .btn-primary {
                        background: #8c675a;
                        border-color: #8c675a;
                        padding: 0.75rem 1.5rem;
                    }

                    .media_sidebar_search .btn-primary:hover {
                        background: #8c675a;
                        border-color: #8c675a;
                        opacity: 0.9;
                    }

                    /* Responsive */
                    @media (max-width: 991px) {
                        .media_type_checkboxes,
                        .category_checkboxes {
                            gap: 0.25rem;
                        }

                        .media_type_checkbox_item .checkbox_content,
                        .category_checkbox_item .checkbox_content {
                            padding: 0.45rem 0.65rem;
                            padding-left: 2rem;
                        }

                        .media_type_checkbox_item .checkbox_content span,
                        .category_checkbox_item .checkbox_content span {
                            font-size: 0.8rem;
                        }
                    }

                    @media (max-width: 576px) {
                        .media_type_checkbox_item .checkbox_content,
                        .category_checkbox_item .checkbox_content {
                            padding: 0.4rem 0.5rem;
                            padding-left: 1.85rem;
                        }

                        .media_type_checkbox_item .checkbox_content:before,
                        .category_checkbox_item .checkbox_content:before {
                            left: 0.4rem;
                            width: 14px;
                            height: 14px;
                        }

                        .media_type_checkbox_item .checkbox_content:after,
                        .category_checkbox_item .checkbox_content:after {
                            left: 0.5rem;
                            font-size: 9px;
                        }

                        .media_type_checkbox_item .checkbox_content i,
                        .category_checkbox_item .checkbox_content i {
                            font-size: 0.85rem;
                        }

                        .media_type_checkbox_item .checkbox_content span,
                        .category_checkbox_item .checkbox_content span {
                            font-size: 0.75rem;
                        }
                    }
                </style>
            </head>

            <div id="wrap" class="js_library_media">
                <!-- Hero Banner Section -->
                <section class="media_hero_banner" t-attf-style="background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(/entro_library_website/static/src/img/hero-image-card.png) center center / cover no-repeat;">
                    <div class="media_hero_content">
                        <p class="tagline">THƯ VIỆN PHÁP ĐĂNG</p>
                        <h1>TÀI NGUYÊN SỐ</h1>
                        <p class="subtitle">Khám phá kho tàng phương tiện - video, âm thanh, hình ảnh và tài liệu</p>
                    </div>
                </section>

                <div class="container mt-4 library_media_container">
                    <div class="row">
                        <!-- Sidebar -->
                        <div class="col-lg-3 mb-4">
                            <!-- Search Box -->
                            <div class="media_sidebar_search mb-4">
                                <form method="get" t-att-action="keep()">
                                    <div class="input-group">
                                        <input type="text" name="search"
                                            class="form-control"
                                            placeholder="Tìm kiếm..."
                                            t-att-value="search" />
                                        <button class="btn btn-primary" type="submit">
                                            <i class="fa fa-search" />
                                        </button>
                                    </div>
                                </form>
                            </div>

                            <!-- Website Categories Filter -->
                            <div class="media_filter_card mb-4" t-if="website_categories">
                                <div class="filter_card_header">
                                    <i class="fa fa-folder-open me-2"/>
                                    <h5 class="mb-0">Danh mục</h5>
                                </div>
                                <div class="filter_card_body">
                                    <form method="get" id="categoryFilterForm" t-att-action="keep()">
                                        <!-- Preserve search and other params -->
                                        <input type="hidden" name="search" t-att-value="search or ''"/>
                                        <input type="hidden" name="sortby" t-att-value="sortby or ''"/>
                                        <!-- Preserve media_type selections -->
                                        <t t-foreach="media_type_list or []" t-as="mt">
                                            <input type="hidden" name="media_type" t-att-value="mt"/>
                                        </t>

                                        <div class="category_checkboxes">
                                            <t t-foreach="website_categories" t-as="web_cat">
                                                <label class="category_checkbox_item">
                                                    <input type="checkbox" name="category_id" t-att-value="web_cat.id"
                                                        t-att-checked="'checked' if (website_category_id_list and web_cat.id in website_category_id_list) else None"
                                                        class="category-checkbox"/>
                                                    <span class="checkbox_content">
                                                        <span t-esc="web_cat.name"/>
                                                    </span>
                                                </label>
                                            </t>
                                        </div>
                                    </form>
                                </div>
                            </div>

                            <script>
                                document.addEventListener('DOMContentLoaded', function() {
                                    // Restore scroll position after page reload
                                    if (sessionStorage.getItem('mediaFilterScrollPos')) {
                                        window.scrollTo(0, parseInt(sessionStorage.getItem('mediaFilterScrollPos')));
                                        sessionStorage.removeItem('mediaFilterScrollPos');
                                    }

                                    // Menu Category Shortcut Filter
                                    var menuCategoryShortcutForm = document.getElementById('menuCategoryShortcutForm');
                                    if (menuCategoryShortcutForm) {
                                        var menuCategoryCheckboxes = menuCategoryShortcutForm.querySelectorAll('.menu-category-checkbox');
                                        var menuCategoryTimer = null;

                                        menuCategoryCheckboxes.forEach(function(checkbox) {
                                            checkbox.addEventListener('change', function(e) {
                                                if (menuCategoryTimer) {
                                                    clearTimeout(menuCategoryTimer);
                                                }
                                                menuCategoryTimer = setTimeout(function() {
                                                    sessionStorage.setItem('mediaFilterScrollPos', window.pageYOffset);
                                                    menuCategoryShortcutForm.submit();
                                                }, 300);
                                            });
                                        });
                                    }

                                    // Media Type Filter
                                    var mediaTypeForm = document.getElementById('mediaTypeFilterForm');
                                    if (mediaTypeForm) {
                                        var mediaTypeCheckboxes = mediaTypeForm.querySelectorAll('.media-type-checkbox');
                                        var mediaTypeTimer = null;

                                        mediaTypeCheckboxes.forEach(function(checkbox) {
                                            checkbox.addEventListener('change', function(e) {
                                                if (mediaTypeTimer) {
                                                    clearTimeout(mediaTypeTimer);
                                                }
                                                mediaTypeTimer = setTimeout(function() {
                                                    sessionStorage.setItem('mediaFilterScrollPos', window.pageYOffset);
                                                    mediaTypeForm.submit();
                                                }, 300);
                                            });
                                        });
                                    }

                                    // Category Filter
                                    var categoryForm = document.getElementById('categoryFilterForm');
                                    if (categoryForm) {
                                        var categoryCheckboxes = categoryForm.querySelectorAll('.category-checkbox');
                                        var categoryTimer = null;

                                        categoryCheckboxes.forEach(function(checkbox) {
                                            checkbox.addEventListener('change', function(e) {
                                                if (categoryTimer) {
                                                    clearTimeout(categoryTimer);
                                                }
                                                categoryTimer = setTimeout(function() {
                                                    sessionStorage.setItem('mediaFilterScrollPos', window.pageYOffset);
                                                    categoryForm.submit();
                                                }, 300);
                                            });
                                        });
                                    }

                                    // Vipassana Category Filter
                                    var vipassanaCategoryForm = document.getElementById('vipassanaCategoryFilterForm');
                                    if (vipassanaCategoryForm) {
                                        var vipassanaCategoryCheckboxes = vipassanaCategoryForm.querySelectorAll('.vipassana-category-checkbox');
                                        var vipassanaCategoryTimer = null;

                                        vipassanaCategoryCheckboxes.forEach(function(checkbox) {
                                            checkbox.addEventListener('change', function(e) {
                                                if (vipassanaCategoryTimer) {
                                                    clearTimeout(vipassanaCategoryTimer);
                                                }
                                                vipassanaCategoryTimer = setTimeout(function() {
                                                    sessionStorage.setItem('mediaFilterScrollPos', window.pageYOffset);
                                                    vipassanaCategoryForm.submit();
                                                }, 300);
                                            });
                                        });
                                    }
                                });
                            </script>

                        </div>

                        <!-- Main content -->
                        <div class="col-lg-9">

                            <!-- Info bar -->
                            <div
                                class="d-flex justify-content-between align-items-center mb-3 flex-wrap">
                                <p class="text-muted mb-0"> Tìm thấy <strong t-esc="media_count" />
                                    tài liệu </p>
                                <!-- Sort -->
                                <form method="get" class="d-flex align-items-center"
                                    t-att-action="keep()">
                                    <label class="me-2 mb-0">Sắp xếp:</label>
                                    <select class="form-select form-select-sm w-auto" name="sortby"
                                        onchange="this.form.submit()">
                                        <option value="date_desc"
                                            t-att-selected="'selected' if sortby == 'date_desc' else None">Mới
                                            nhất</option>
                                        <option value="date_asc"
                                            t-att-selected="'selected' if sortby == 'date_asc' else None">Cũ
                                            nhất</option>
                                        <option value="name_asc"
                                            t-att-selected="'selected' if sortby == 'name_asc' else None">Tên
                                            A-Z</option>
                                        <option value="name_desc"
                                            t-att-selected="'selected' if sortby == 'name_desc' else None">Tên
                                            Z-A</option>
                                        <option value="views_desc"
                                            t-att-selected="'selected' if sortby == 'views_desc' else None">Xem
                                            nhiều nhất</option>
                                        <option value="downloads_desc"
                                            t-att-selected="'selected' if sortby == 'downloads_desc' else None">Tải
                                            nhiều nhất</option>
                                    </select>
                                </form>
                            </div>

                            <!-- Media grid -->
                            <div class="row media_grid" t-if="media_items">
                                <t t-foreach="media_items" t-as="media">
                                    <div class="col-md-4 col-sm-6 mb-4">
                                        <t t-call="entro_library_website.library_media_card" />
                                    </div>
                                </t>
                            </div>

                            <!-- No results -->
                            <div t-if="not media_items" class="alert alert-info text-center">
                                <i class="fa fa-info-circle fa-2x mb-2 d-block" />
                                <p class="mb-0">Không tìm thấy tài liệu nào phù hợp.</p>
                            </div>

                            <!-- Pagination -->
                            <div t-if="pager" class="mt-4 mb-4">
                                <t t-call="website.pager">
                                    <t t-set="classname">justify-content-center</t>
                                </t>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </t>
    </template>


    <!-- ========== MEDIA CARD COMPONENT ========== -->

    <template id="library_media_card" name="Thẻ Phương Tiện">
        <div class="card media_card shadow-sm h-100">
            <a t-attf-href="/media/#{media.id}"
                class="text-decoration-none text-dark d-flex flex-column h-100">
                <div class="card-img-top media_thumbnail position-relative overflow-hidden"
                    style="height: 200px;">
                    <!-- Thumbnail -->
                    <t t-if="media.thumbnail">
                        <img t-att-src="'/web/image/library.media/%s/thumbnail' % media.id"
                            t-att-alt="media.name"
                            class="w-100 h-100"
                            style="object-fit: cover;" />
                    </t>
                    <t t-else="">
                        <div
                            class="bg-gradient d-flex align-items-center justify-content-center h-100"
                            t-attf-style="background: linear-gradient(135deg, #{media.media_type == 'video' and '#667eea 0%, #764ba2 100%' or media.media_type == 'audio' and '#f093fb 0%, #f5576c 100%' or media.media_type == 'image' and '#4facfe 0%, #00f2fe 100%' or '#43e97b 0%, #38f9d7 100%'});">
                            <t t-if="media.media_type == 'video'">
                                <i class="fa fa-video-camera fa-4x text-white" />
                            </t>
                            <t t-elif="media.media_type == 'audio'">
                                <i class="fa fa-music fa-4x text-white" />
                            </t>
                            <t t-elif="media.media_type == 'image'">
                                <i class="fa fa-image fa-4x text-white" />
                            </t>
                            <t t-else="">
                                <i class="fa fa-file-pdf-o fa-4x text-white" />
                            </t>
                        </div>
                    </t>

                    <!-- Duration Badge (for video/audio) -->
                    <t t-if="media.duration_display and media.media_type in ['video', 'audio']">
                        <span class="badge bg-dark position-absolute bottom-0 end-0 m-2 opacity-75">
                            <i class="fa fa-clock-o me-1" />
                            <t t-esc="media.duration_display" />
                        </span>
                    </t>

                    <!-- Access Level Badge -->
                    <t t-if="media.access_level != 'public'">
                        <span class="badge bg-warning position-absolute top-0 end-0 m-2">
                            <i class="fa fa-lock me-1" />
                            <t t-if="media.access_level == 'members'">Thành viên</t>
                            <t t-elif="media.access_level == 'restricted'">Hạn chế</t>
                        </span>
                    </t>
                </div>

                <div class="card-body">
                    <h5 class="card-title media_title text-truncate mb-2" t-att-title="media.name"
                        t-esc="media.name" />

                    <p class="card-text text-muted small mb-2 text-truncate" t-if="media.author">
                        <i class="fa fa-user me-1" />
                        <t t-esc="media.author" />
                    </p>

                    <!-- Media Type -->
                    <p class="card-text small text-muted mb-2">
                        <i class="fa fa-tag me-1"/>
                        <t t-if="media.media_type == 'video'">Video</t>
                        <t t-elif="media.media_type == 'audio'">Âm thanh</t>
                        <t t-elif="media.media_type == 'image'">Hình ảnh</t>
                        <t t-else="">Tài liệu</t>
                    </p>

                    <!-- Publication Date or Create Date -->
                    <p class="card-text small mb-0">
                        <i class="fa fa-calendar me-1"/>
                        <t t-esc="media.publication_date or (media.create_date and media.create_date.strftime('%Y')) or 'N/A'" />
                    </p>
                </div>

                <div class="card-footer bg-transparent border-top">
                    <div class="d-flex justify-content-between align-items-center">
                        <small class="text-muted">
                            <i class="fa fa-eye"/>
                            <t t-esc="media.view_count" />
                        </small>
                        <span class="btn btn-sm btn-primary">Xem chi tiết</span>
                    </div>
                </div>
            </a>
        </div>
    </template>


    <!-- ========== MEDIA DETAIL PAGE ========== -->

    <template id="library_media_detail" name="Chi Tiết Phương Tiện">
        <t t-call="website.layout">
            <div id="wrap" class="js_library_media_detail" t-att-data-media-id="media.id">
                <div class="container mt-4 mb-5">

                    <!-- Breadcrumb -->
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item">
                                <a href="/media">Tài liệu số</a>
                            </li>
                            <li class="breadcrumb-item" t-if="media.website_category_id">
                                <a t-attf-href="/media/danh-muc/#{media.website_category_id.id}">
                                    <t t-esc="media.website_category_id.name" />
                                </a>
                            </li>
                            <li class="breadcrumb-item active" aria-current="page">
                                <t t-esc="media.name" />
                            </li>
                        </ol>
                    </nav>

                    <div class="row">
                        <!-- Main Content -->
                        <div class="col-lg-8">
                            <!-- Media Title -->
                            <h1 class="mb-3" t-esc="media.name" />

                            <!-- Media Info Bar -->
                            <div class="d-flex flex-wrap gap-3 mb-4 text-muted small">
                                <span>
                                    <i class="fa fa-user" />
                                    <t t-esc="media.author or 'Không rõ'" />
                                </span>
                                <span>
                                    <i class="fa fa-eye" /> <t t-esc="media.view_count" /> lượt xem </span>
                                <span t-if="media.is_downloadable">
                                    <i class="fa fa-download" /> <t t-esc="media.download_count" />
                                    lượt tải </span>
                                <span t-if="media.publication_date">
                                    <i class="fa fa-calendar" />
                                    <t t-esc="media.publication_date" />
                                </span>
                                <span
                                    t-if="media.duration_display and media.media_type in ['video', 'audio']">
                                    <i class="fa fa-clock-o" />
                                    <t t-esc="media.duration_display" />
                                </span>
                            </div>

                            <!-- Media Player/Viewer -->
                            <div class="media_player_container mb-4">
                                <!-- VIDEO PLAYER -->
                                <t t-if="media.media_type == 'video'">
                                    <t t-call="entro_library_website.media_video_player" />
                                </t>

                                <!-- AUDIO PLAYER -->
                                <t t-elif="media.media_type == 'audio'">
                                    <t t-call="entro_library_website.media_audio_player" />
                                </t>

                                <!-- IMAGE VIEWER -->
                                <t t-elif="media.media_type == 'image'">
                                    <t t-call="entro_library_website.media_image_viewer" />
                                </t>

                                <!-- PDF VIEWER -->
                                <t t-elif="media.media_type == 'document'">
                                    <t t-call="entro_library_website.media_pdf_viewer" />
                                </t>
                            </div>

                            <!-- Action Buttons -->
                            <div class="media_actions mb-4">
                                <t t-if="media.is_downloadable and media.storage_type == 'file'">
                                    <a t-attf-href="/media/#{media.id}/tai-xuong"
                                        class="btn btn-primary">
                                        <i class="fa fa-download me-2" /> Tải xuống </a>
                                </t>
                            </div>

                            <!-- Description -->
                            <div class="media_description mb-4" t-if="media.description">
                                <h4>Mô tả</h4>
                                <div t-field="media.description" class="oe_structure" />
                            </div>

                            <!-- Metadata -->
                            <div class="media_metadata mb-4">
                                <h4>Thông tin chi tiết</h4>
                                <table class="table table-sm">
                                    <tbody>
                                        <tr t-if="media.category_id">
                                            <th style="width: 30%;">Danh mục:</th>
                                            <td>
                                                <t t-esc="media.category_id.name" />
                                            </td>
                                        </tr>
                                        <tr t-if="media.language_id">
                                            <th>Ngôn ngữ:</th>
                                            <td>
                                                <t t-esc="media.language_id.name" />
                                            </td>
                                        </tr>
                                        <tr t-if="media.keywords">
                                            <th>Từ khóa:</th>
                                            <td>
                                                <t t-esc="media.keywords" />
                                            </td>
                                        </tr>
                                        <tr t-if="media.storage_type == 'file' and media.file_size">
                                            <th>Kích thước:</th>
                                            <td><t t-esc="'%.2f' % media.file_size" /> MB</td>
                                        </tr>
                                        <tr t-if="media.storage_type == 'file' and media.mime_type">
                                            <th>Định dạng:</th>
                                            <td>
                                                <t t-esc="media.mime_type" />
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                        </div>

                        <!-- Sidebar -->
                        <div class="col-lg-4">
                            <!-- Related Media -->
                            <div class="related_media" t-if="related_media">
                                <h4 class="mb-3">Liên quan</h4>
                                <div class="list-group">
                                    <t t-foreach="related_media" t-as="rel_media">
                                        <a t-attf-href="/media/#{rel_media.id}"
                                            class="list-group-item list-group-item-action">
                                            <div class="d-flex align-items-start">
                                                <div class="me-2"
                                                    style="width: 80px; height: 60px; flex-shrink: 0;">
                                                    <t t-if="rel_media.thumbnail">
                                                        <img
                                                            t-att-src="'/web/image/library.media/%s/thumbnail' % rel_media.id"
                                                            class="img-fluid rounded"
                                                            style="width: 100%; height: 100%; object-fit: cover;" />
                                                    </t>
                                                    <t t-else="">
                                                        <div
                                                            class="bg-secondary rounded d-flex align-items-center justify-content-center h-100">
                                                            <i class="fa fa-file text-white" />
                                                        </div>
                                                    </t>
                                                </div>
                                                <div class="flex-grow-1 min-w-0">
                                                    <h6 class="mb-1 text-truncate"
                                                        t-esc="rel_media.name" />
                                                    <small class="text-muted">
                                                        <i class="fa fa-eye" />
                                                        <t t-esc="rel_media.view_count" />
                                                    </small>
                                                </div>
                                            </div>
                                        </a>
                                    </t>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </t>
    </template>


    <!-- ========== VIDEO PLAYER ========== -->

    <template id="media_video_player" name="Video Player">
        <div class="video_player_wrapper">
            <!-- YouTube Video -->
            <t t-if="youtube_id">
                <div class="ratio ratio-16x9">
                    <iframe t-attf-src="https://www.youtube.com/embed/#{youtube_id}"
                        frameborder="0"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                        allowfullscreen="" />
                </div>
            </t>

            <!-- Vimeo Video -->
            <t t-elif="vimeo_id">
                <div class="ratio ratio-16x9">
                    <iframe t-attf-src="https://player.vimeo.com/video/#{vimeo_id}"
                        frameborder="0"
                        allow="autoplay; fullscreen; picture-in-picture"
                        allowfullscreen="" />
                </div>
            </t>

            <!-- HTML5 Video (uploaded file) -->
            <t t-elif="media.storage_type == 'file' and media.file">
                <div class="ratio ratio-16x9">
                    <video controls="" class="w-100">
                        <source t-attf-src="/web/content/library.media/#{media.id}/file"
                            t-att-type="media.mime_type or 'video/mp4'" /> Trình duyệt của bạn không
                        hỗ trợ phát video. </video>
                </div>
            </t>

            <!-- External URL (direct video link) -->
            <t t-elif="media.storage_type == 'url' and media.file_url">
                <div class="ratio ratio-16x9">
                    <video controls="" class="w-100">
                        <source t-att-src="media.file_url"
                            t-att-type="media.mime_type or 'video/mp4'" /> Trình duyệt của bạn không
                        hỗ trợ phát video. </video>
                </div>
            </t>
        </div>
    </template>


    <!-- ========== AUDIO PLAYER ========== -->

    <template id="media_audio_player" name="Audio Player">
        <div class="audio_player_wrapper p-4 bg-light rounded">
            <!-- HTML5 Audio (uploaded file) -->
            <t t-if="media.storage_type == 'file' and media.file">
                <audio controls="" class="w-100">
                    <source t-attf-src="/web/content/library.media/#{media.id}/file"
                        t-att-type="media.mime_type or 'audio/mpeg'" /> Trình duyệt của bạn không hỗ
                    trợ phát âm thanh. </audio>
            </t>

            <!-- External URL (direct audio link) -->
            <t t-elif="media.storage_type == 'url' and media.file_url">
                <audio controls="" class="w-100">
                    <source t-att-src="media.file_url"
                        t-att-type="media.mime_type or 'audio/mpeg'" /> Trình duyệt của bạn không hỗ
                    trợ phát âm thanh. </audio>
            </t>

            <!-- Display thumbnail if available -->
            <div class="text-center mt-3" t-if="media.thumbnail">
                <img t-att-src="'/web/image/library.media/%s/thumbnail' % media.id"
                    class="img-fluid rounded"
                    style="max-width: 300px;" />
            </div>
        </div>
    </template>


    <!-- ========== IMAGE VIEWER ========== -->

    <template id="media_image_viewer" name="Image Viewer">
        <div class="image_viewer_wrapper">
            <t t-if="media.storage_type == 'file' and media.file">
                <div id="lightgallery" class="text-center">
                    <a t-attf-href="/web/content/library.media/#{media.id}/file"
                        data-lg-size="1920-1080">
                        <img t-attf-src="/web/content/library.media/#{media.id}/file"
                            t-att-alt="media.name"
                            class="img-fluid rounded shadow-sm"
                            style="max-height: 600px; cursor: pointer;" />
                    </a>
                </div>
            </t>

            <t t-elif="media.storage_type == 'url' and media.file_url">
                <div id="lightgallery" class="text-center">
                    <a t-att-href="media.file_url" data-lg-size="1920-1080">
                        <img t-att-src="media.file_url"
                            t-att-alt="media.name"
                            class="img-fluid rounded shadow-sm"
                            style="max-height: 600px; cursor: pointer;" />
                    </a>
                </div>
            </t>
        </div>
    </template>


    <!-- ========== PDF VIEWER ========== -->

    <template id="media_pdf_viewer" name="PDF Viewer">
        <div class="pdf_viewer_wrapper">
            <t t-if="media.storage_type == 'file' and media.file">
                <div class="pdf-container">
                    <!-- Desktop: Use PDF.js -->
                    <iframe t-attf-src="/web/static/lib/pdfjs/web/viewer.html?file=%2Fweb%2Fcontent%2Flibrary.media%2F#{media.id}%2Ffile"
                            class="pdf-iframe pdf-desktop">
                    </iframe>

                    <!-- iOS Fallback: Direct link with download option -->
                    <div class="pdf-ios-fallback" style="display: none;">
                        <div class="text-center p-5">
                            <p class="text-muted mb-4">Nhấn vào nút bên dưới để xem tài liệu</p>
                            <div class="d-flex flex-column gap-2 align-items-center">
                                <a t-attf-href="/web/content/library.media/#{media.id}/file"
                                   class="btn btn-primary btn-lg"
                                   target="_blank">
                                    <i class="fa fa-external-link me-2"></i> Xem tài liệu
                                </a>
                                <a t-attf-href="/web/content/library.media/#{media.id}/file"
                                   class="btn btn-outline-primary"
                                   download="">
                                    <i class="fa fa-download me-2"></i> Tải xuống
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </t>

            <t t-elif="media.storage_type == 'url' and media.file_url">
                <div class="pdf-container">
                    <!-- Desktop: Use PDF.js -->
                    <iframe t-attf-src="/web/static/lib/pdfjs/web/viewer.html?file=#{media.file_url}"
                            class="pdf-iframe pdf-desktop">
                    </iframe>

                    <!-- iOS Fallback: Direct link -->
                    <div class="pdf-ios-fallback" style="display: none;">
                        <div class="text-center p-5">
                            <i class="fa fa-file-pdf-o fa-5x text-danger mb-4"></i>
                            <h4 class="mb-3">Xem PDF</h4>
                            <p class="text-muted mb-4">Nhấn vào nút bên dưới để xem tài liệu PDF</p>
                            <a t-att-href="media.file_url"
                               class="btn btn-primary btn-lg"
                               target="_blank">
                                <i class="fa fa-external-link me-2"></i> Mở PDF
                            </a>
                        </div>
                    </div>
                </div>
            </t>
        </div>

        <!-- JavaScript to detect iOS and show appropriate viewer -->
        <script type="text/javascript">
            (function() {
                // Detect iOS devices
                function isIOSDevice() {
                    return /iPad|iPhone|iPod/.test(navigator.userAgent) &amp;&amp; !window.MSStream;
                }

                // Run on page load
                if (isIOSDevice()) {
                    document.addEventListener('DOMContentLoaded', function() {
                        var containers = document.querySelectorAll('.pdf-container');
                        containers.forEach(function(container) {
                            var desktopViewer = container.querySelector('.pdf-desktop');
                            var iosFallback = container.querySelector('.pdf-ios-fallback');

                            if (desktopViewer) desktopViewer.style.display = 'none';
                            if (iosFallback) iosFallback.style.display = 'block';
                        });
                    });
                }
            })();
        </script>
    </template>

</odoo>